{
  "hash": "9336fa54f88bdea560430e9cddeb37f2",
  "result": {
    "engine": "knitr",
    "markdown": "# Data insights {#sec-insights}\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n:::\n\n\n\n\nFor this exercise we will propose that our task is to generate insights into the relationship between bill (culmen) length and bill (culmen) depth of our penguins, in order to answer the question\n\nIn order to answer this question properly we should first understand our different variables and how they might relate to each other.\n\n- Distribution of data types\n\n- Central tendency\n\n- Relationship between variables\n\n- Confounding variables\n\nThis inevitably leads to more and a variety of questions. Each new question that you ask will expose you to a new aspect of your data.\n\n### Data checking\n\nImportantly you should have already generated an understanding of the variables contained within your dataset during the data wrangling steps. Including:\n\n- The number of variables\n\n- The data format of each variable\n\n- Checked for missing data\n\n- Checked for typos, duplications or other data errors\n\n- Cleaned column or factor names\n\n## Explore the distribution of categories\n\nUnderstanding how your data is distributed across important grouping variables is essential for context. In this case, the Palmer Penguins dataset includes key groupings such as species, island, and year, which might have significant effects on the relationships we want to study (e.g., between bill length and bill depth). By summarizing and visualizing the distribution of these variables, we can ensure that our analyses account for group-level differences, leading to more robust insights.\n\n### Frequency\n\nBy grouping the data according to the species variable, it calculates the total count (n) of penguins within each species. This summary helps us understand the distribution of penguin species in the dataset, giving insights into the sample size available for each group, which is important for any further analysis or comparison between species.\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npenguins |> \n  # calculations applied per species\n  group_by(species) |> \n  # summarise the number of observations in each group\n  summarise(n = n())\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|species   |   n|\n|:---------|---:|\n|Adelie    | 152|\n|Chinstrap |  68|\n|Gentoo    | 124|\n\n</div>\n:::\n:::\n\n\n\n\n**Question** Are there 152 different penguins in our dataset? <select class='webex-select'><option value='blank'></option><option value=''>TRUE</option><option value='answer'>FALSE</option></select>\n\n\n<div class='webex-solution'><button>Explanation</button>\n\n\nThe functions above count the number of rows of data - we need to determine if these are repeated or independent measures. We should remember that there is a column called `individual_id` if we use the `n_distinct()` function we can count how many unique IDs we have\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npenguins |> \n  # calculations applied per species\n  group_by(species) |> \n  # summarise the number of observations in each group\n  summarise(n = n_distinct(individual_id))\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|species   |   n|\n|:---------|---:|\n|Adelie    | 132|\n|Chinstrap |  58|\n|Gentoo    |  94|\n\n</div>\n:::\n:::\n\n\n\n\nNow we can see that there are only 132 *different* Adelie penguins in our data\n\n\n</div>\n\n\n\n### Relative Frequency\n\nIt might be useful for us to make some quick data summaries here, like relative frequency\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nprob_obs_species <- penguins |> \n  group_by(species) |> \n  summarise(n = n()) |> \n  # use mutate to make a new column relative frequency\n  mutate(prob_obs = n/sum(n))\n\nprob_obs_species\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|species   |   n|  prob_obs|\n|:---------|---:|---------:|\n|Adelie    | 152| 0.4418605|\n|Chinstrap |  68| 0.1976744|\n|Gentoo    | 124| 0.3604651|\n\n</div>\n:::\n:::\n\n\n\nSo about 44% of our sample is made up of observations from Adelie penguins. When it comes to making summaries about categorical data, that's about the best we can do, we can make observations about the most common categorical observations, and the relative proportions.\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npenguins |> \n  mutate(species=fct_relevel(species, \n                             \"Adelie\",\n                             \"Gentoo\",\n                             \"Chinstrap\")) |> \n  # set as factor and provide levels\n  ggplot()+\n  geom_bar(aes(x=species),\n           fill=\"steelblue\",\n           width=0.8)+\n  labs(x=\"Species\",\n       y = \"Number of observations\")+\n  geom_text(data=prob_obs_species,\n            aes(y=(n+10),\n                x=species,\n                label=scales::percent(prob_obs)))+\n  coord_flip()\n```\n\n::: {.cell-output-display}\n![](07-data-insights_files/figure-html/unnamed-chunk-5-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\n\nThis is an example of a figure we might use in a report or paper. Having cleaned up the theme, added some simple colour, made sure our labels are clear and descriptive, ordered our categories in ascending frequency order, and included some simple text of percentages to aid readability.\n\n\n## Two or more categories\n\nThink about what might be a suitable confounding variable to investigate and graph here?\n\n\n<div class='webex-solution'><button>Solution</button>\n\n\nUnderstanding how frequency is broken down by island, species year and sex might be useful.\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npenguins |> \n  group_by(island, year, species, sex) |> \n  summarise(n = n()) \n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|island    | year|species   |sex    |  n|\n|:---------|----:|:---------|:------|--:|\n|Biscoe    | 2007|Adelie    |Female |  5|\n|Biscoe    | 2007|Adelie    |Male   |  5|\n|Biscoe    | 2007|Gentoo    |Female | 16|\n|Biscoe    | 2007|Gentoo    |Male   | 17|\n|Biscoe    | 2007|Gentoo    |NA     |  1|\n|Biscoe    | 2008|Adelie    |Female |  9|\n|Biscoe    | 2008|Adelie    |Male   |  9|\n|Biscoe    | 2008|Gentoo    |Female | 22|\n|Biscoe    | 2008|Gentoo    |Male   | 23|\n|Biscoe    | 2008|Gentoo    |NA     |  1|\n|Biscoe    | 2009|Adelie    |Female |  8|\n|Biscoe    | 2009|Adelie    |Male   |  8|\n|Biscoe    | 2009|Gentoo    |Female | 20|\n|Biscoe    | 2009|Gentoo    |Male   | 21|\n|Biscoe    | 2009|Gentoo    |NA     |  3|\n|Dream     | 2007|Adelie    |Female |  9|\n|Dream     | 2007|Adelie    |Male   | 10|\n|Dream     | 2007|Adelie    |NA     |  1|\n|Dream     | 2007|Chinstrap |Female | 13|\n|Dream     | 2007|Chinstrap |Male   | 13|\n|Dream     | 2008|Adelie    |Female |  8|\n|Dream     | 2008|Adelie    |Male   |  8|\n|Dream     | 2008|Chinstrap |Female |  9|\n|Dream     | 2008|Chinstrap |Male   |  9|\n|Dream     | 2009|Adelie    |Female | 10|\n|Dream     | 2009|Adelie    |Male   | 10|\n|Dream     | 2009|Chinstrap |Female | 12|\n|Dream     | 2009|Chinstrap |Male   | 12|\n|Torgersen | 2007|Adelie    |Female |  8|\n|Torgersen | 2007|Adelie    |Male   |  7|\n|Torgersen | 2007|Adelie    |NA     |  5|\n|Torgersen | 2008|Adelie    |Female |  8|\n|Torgersen | 2008|Adelie    |Male   |  8|\n|Torgersen | 2009|Adelie    |Female |  8|\n|Torgersen | 2009|Adelie    |Male   |  8|\n\n</div>\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npenguins |> \n   ggplot(aes(x = species,\n             fill = sex))+\n   geom_bar(width=0.8,\n            position = position_dodge())+\n  labs(x=\"Species\",\n       y = \"Number of observations\")+\n  facet_grid(island ~ year)\n```\n\n::: {.cell-output-display}\n![](07-data-insights_files/figure-html/unnamed-chunk-7-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\n\n\n\n</div>\n\n\nBy thinking about the way in which categories might interact we can consider interesting patterns or potential issues in data collection. \n\n- Looking at these patterns I am reassured that the number of males and females spotted is roughly equal across species and locations. \n\n- There are different numbers of species on different islands, but this is consistent across years so hopefully represents true species distributions. \n\n- The number of penguins is consistent across years\n\n- There are some missing values for sex, but they are small and don't fit a strong pattern.\n\n\n## Missing data\n\nIn the previous section above we were able to characterise some missing data, but only a little and it appears to be fairly random. This means we can probably safely remove it from calculations or statistics without issue. \n\nBut what about our variables of interest? Culmen length and depth? We previously used `skimr::skim` and `summary` to identify there were two missing values each for culmen length and depth. Although this is unlikely to cause any issues of bias in our data it might be nice to know where these missing values are located in our data?\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npenguins |>\n  # Filter rows where culmen length is NA\n  filter(is.na(culmen_length_mm)) |> \n  # Group by species, sex and island\n  group_by(species, sex, year, island) |>                 \n  summarise(n_missing = n())    \n\npenguins |>\n  filter(is.na(culmen_depth_mm)) |>         \n  group_by(species, sex, year, island) |>               \n  summarise(n_missing = n())    \n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|species |sex | year|island    | n_missing|\n|:-------|:---|----:|:---------|---------:|\n|Adelie  |NA  | 2007|Torgersen |         1|\n|Gentoo  |NA  | 2009|Biscoe    |         1|\n\n</div><div class=\"kable-table\">\n\n|species |sex | year|island    | n_missing|\n|:-------|:---|----:|:---------|---------:|\n|Adelie  |NA  | 2007|Torgersen |         1|\n|Gentoo  |NA  | 2009|Biscoe    |         1|\n\n</div>\n:::\n:::\n\n\n\n\nThere is data missing from one Adelie penguin in 2007 on Torgersen, and one value missing from a Gentoo penguin in 2009 on Biscoe. This is true for both culmen length and depth, it is probably the same penguin in both cases, but how could we change our code to be sure?\n\n\n<div class='webex-solution'><button>Solution</button>\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npenguins |>\n  filter(is.na(culmen_length_mm)) |> \n# ADD individual id into group_by arguments\n  group_by(species, sex, year, island, individual_id) |>                 \n  summarise(n_missing = n())    \n\npenguins |>\n  filter(is.na(culmen_depth_mm)) |>         \n  group_by(species, sex, year, island, individual_id) |>               \n  summarise(n_missing = n())    \n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|species |sex | year|island    |individual_id | n_missing|\n|:-------|:---|----:|:---------|:-------------|---------:|\n|Adelie  |NA  | 2007|Torgersen |N2A2          |         1|\n|Gentoo  |NA  | 2009|Biscoe    |N38A2         |         1|\n\n</div><div class=\"kable-table\">\n\n|species |sex | year|island    |individual_id | n_missing|\n|:-------|:---|----:|:---------|:-------------|---------:|\n|Adelie  |NA  | 2007|Torgersen |N2A2          |         1|\n|Gentoo  |NA  | 2009|Biscoe    |N38A2         |         1|\n\n</div>\n:::\n:::\n\n\n\n\n</div>\n\n\nAgain here we could safely drop these from our data and regard these as missing at random. \n\n### remove na\n\nThere are a few different ways we can deal with missing data:\n\n- `drop_na()` on everything before we start. \n\nThis runs the risk that we lose a lot of data as every row, with an NA in any column will be removed\n\n- `drop_na()` on a particular variable. \n\nThis is fine, but we should approach this cautiously - if we do this in a way where we write this data into a new object e.g. `penguins <- penguins |>  drop_na(body_mass_g)` then we have removed this data forever - perhaps we only want to drop those rows for a specific calculation - again they might contain useful information in other variables.\n\n- Use arguments inside functions \n\n`mean(x, na.rm = T)` Many summary functions have the argument to include or exclude missingness, by default `mean()` is set to `na.rm = F` and will produce an NA value if there is any missingness, once we have investigated this we could simply set `na.rm = T` and remove NA from the calculations\n\n## Continuous distributions\n\nVariation is the tendency of the values of a variable to change from measurement to measurement. You can see variation easily in real life; if you measure any continuous variable twice, you will get two different results. This is true even if you measure quantities that are constant, like the speed of light. Each of your measurements will include a small amount of error that varies from measurement to measurement. Every variable has its own pattern of variation, which can reveal interesting information. The best way to understand that pattern is to visualise the distribution of the variable’s values.\n\n:::{.callout-important}\n\nIn the examples below I will look at the distributions of culmen length, you should modify and duplicate the code so that you check both culmen length and culmen depth.\n\n:::\n\n\n### Histograms\n\nThis is the script to plot a frequency distribution, we only specify an x variable, because we intend to plot a histogram, and the y variable is always the count of observations. Here we ask the data to be presented in 10 equally sized bins of data. In this case chopping the x axis range into 10 equal parts and counting the number of observations that fall within each one.\n\nHistograms are helpful because they show the distribution of a single numerical variable. They divide the data into \"bins\" (ranges of values) and count how many data points fall into each bin. This helps you:\n\nSee the shape of the data: You can easily spot if the data is normally distributed, skewed, or has multiple peaks (modes).\nIdentify data spread: Histograms help you understand the spread or range of your data values.\nDetect outliers: Unusually high or low values become more noticeable in a histogram.\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npenguins |> \n  ggplot()+\n  geom_histogram(aes(x=culmen_length_mm),\n                 bins=10)\n```\n\n::: {.cell-output-display}\n![](07-data-insights_files/figure-html/unnamed-chunk-10-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\n\n\n\n:::{.callout-tip}\n\n## Change the bin argument\n\nChange the value specified to the bins argument and observe how the figure changes. It is usually a very good idea to try more than one set of bins in order to have better insights into the data\n\n:::\n\n### Boxplots\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npenguins |> \n  ggplot()+\n  geom_boxplot(aes(x=culmen_length_mm))\n```\n\n::: {.cell-output-display}\n![](07-data-insights_files/figure-html/unnamed-chunk-11-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\n\n\n\nBoxplots are useful because they provide a summary of the distribution of a numerical variable in a compact visual form. They help you see:\n\n- Central tendency: The middle line in the box shows the median (middle value) of the data.\n\n- Spread and variability: The length of the box (interquartile range) shows how spread out the data is.\n\n- Outliers: Boxplots clearly show outliers as points outside the \"whiskers,\" making them great for detecting extreme values.\n\n- Comparison between groups: You can easily compare the distribution of a variable across different groups (e.g., species) by using multiple boxplots side by side.\n\n## Continuous and categorical\n\nIt’s common to want to explore the distribution of a continuous variable broken down by a categorical variable.\n\nThe best and simplest place to start exploring these possible relationships is by producing simple figures.\n\nLet's start by looking at the distribution of culmen length by species\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npenguins %>% \n    ggplot(aes(x = species,\n               y = body_mass_g,\n               fill = species))+\n    geom_boxplot(width = 0.2)+\n  coord_flip()\n```\n\n::: {.cell-output-display}\n![](07-data-insights_files/figure-html/unnamed-chunk-12-1.png){fig-align='center' width=100%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npenguins %>% \n  ggplot(aes(fill = species))+\n  geom_density(aes(x = culmen_length_mm),\n                   position = \"identity\",\n                   alpha = 0.6)\n```\n\n::: {.cell-output-display}\n![](07-data-insights_files/figure-html/unnamed-chunk-13-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\n\n\n\n### GGridges\n\nThe package ggridges (Wilke (2021)) provides some excellent extra geoms to supplement ggplot. One if its most useful features is to to allow different groups to be mapped to the y axis, so that histograms are more easily viewed.\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(ggridges)\nggplot(penguins, aes(x = culmen_length_mm, \n                     y = species)) + \n  ggridges::geom_density_ridges()\n```\n\n::: {.cell-output-display}\n![](07-data-insights_files/figure-html/unnamed-chunk-14-1.png){fig-align='center' width=100%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npenguins |> \n  drop_na() |> \nggplot(aes(x = culmen_length_mm, \n                     y = species, fill = sex)) + \n    ggridges::geom_density_ridges()\n```\n\n::: {.cell-output-display}\n![](07-data-insights_files/figure-html/unnamed-chunk-15-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\n\n\n\n## Normality\n\nIf our data follows a normal distribution, then we can predict the spread of our data, and the likelihood of observing a datapoint of any given value with only the mean and standard deviation.\n\n### QQplot\n\nA QQ plot is a classic way of checking whether a sample distribution is the same as another (or theoretical distribution). They look a bit odd at first, but they are actually fairly easy to understand, and very useful! The qqplot distributes your data on the y-axis, and a theoretical normal distribution on the x-axis. If the residuals follow a normal distribution, they should meet to produce a perfect diagonal line across the plot.\n\nWatch this video to see QQ plots explained\n\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(qqplotr)\nggplot(penguins, aes(sample = culmen_length_mm))+\n    stat_qq_band() +\n    stat_qq_line() +\n    stat_qq_point() \n```\n\n::: {.cell-output-display}\n![](07-data-insights_files/figure-html/unnamed-chunk-16-1.png){fig-align='center' width=100%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(rstatix)\n\npenguins %>% \n  shapiro_test(culmen_length_mm)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|variable         | statistic|        p|\n|:----------------|---------:|--------:|\n|culmen_length_mm | 0.9748548| 1.12e-05|\n\n</div>\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(qqplotr)\nggplot(penguins, aes(sample = culmen_length_mm))+\n    stat_qq_band() +\n    stat_qq_line() +\n    stat_qq_point() +\n  facet_wrap(~species)\n```\n\n::: {.cell-output-display}\n![](07-data-insights_files/figure-html/unnamed-chunk-18-1.png){fig-align='center' width=100%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npenguins %>% \n  group_by(species) |> \n  shapiro_test(culmen_length_mm)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|species   |variable         | statistic|         p|\n|:---------|:----------------|---------:|---------:|\n|Adelie    |culmen_length_mm | 0.9933618| 0.7166005|\n|Chinstrap |culmen_length_mm | 0.9752496| 0.1940926|\n|Gentoo    |culmen_length_mm | 0.9727224| 0.0134914|\n\n</div>\n:::\n:::\n\n\n\n\n## Summary statistics\n\n### Mean and standard deviation\n\nstandard deviation (or s) is a measure of how dispersed the data is in relation to the mean. Low standard deviation means data are clustered around the mean, and high standard deviation indicates data are more spread out. As such it makes sense only to use this when the mean is a good measure of our central tendency.\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npenguins |> \n  group_by(species) |> \n  summarise(mean = mean(culmen_length_mm),\n            sd = sd(culmen_length_mm))\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|species   |     mean|       sd|\n|:---------|--------:|--------:|\n|Adelie    |       NA|       NA|\n|Chinstrap | 48.83382| 3.339256|\n|Gentoo    |       NA|       NA|\n\n</div>\n:::\n:::\n\n\n\n\n<div class='webex-solution'><button>Solution</button>\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npenguins |> \n  group_by(species) |> \n  summarise(mean = mean(culmen_length_mm, na.rm = T),\n            sd = sd(culmen_length_mm, na.rm =T))\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|species   |     mean|       sd|\n|:---------|--------:|--------:|\n|Adelie    | 38.79139| 2.663405|\n|Chinstrap | 48.83382| 3.339256|\n|Gentoo    | 47.50488| 3.081857|\n\n</div>\n:::\n:::\n\n\n\n\n\n</div>\n\n\n### Median and quartiles\n\nWhen dealing with data that does not fit a normal distribution, using summary statistics like max, min, median, and interquartile range (IQR) provides a robust way to describe the data's spread and central tendency. Unlike the mean and standard deviation, which are sensitive to outliers and skewed data, the median and IQR give a more accurate representation of the distribution's center and spread in non-normal data.\n\n- Median: This is the middle value and provides a better measure of central tendency than the mean when data is skewed.\nIQR (Interquartile Range): This measures the spread of the middle 50% of the data (between the 25th and 75th percentiles) and is less affected by extreme values.\n\n- Min and Max: These values show the range of the data, highlighting any extreme values or outliers.\n\nThese summary statistics directly correspond to the boxplot: the median is the line inside the box, the IQR defines the box's edges, and the min/max (after removing outliers) are represented by the ends of the whiskers.\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npenguins |> \n  group_by(species) |> \n  summarise(median = median(culmen_length_mm, na.rm = T),\n            quantile = quantile(culmen_length_mm, c(0.25, 0.5, 0.75), na.rm=TRUE),\n            max = max(culmen_length_mm, na.rm = T),\n            min = min(culmen_length_mm), na.rm = T)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|species   | median| quantile|  max|  min|na.rm |\n|:---------|------:|--------:|----:|----:|:-----|\n|Adelie    |  38.80|   36.750| 46.0|   NA|TRUE  |\n|Adelie    |  38.80|   38.800| 46.0|   NA|TRUE  |\n|Adelie    |  38.80|   40.750| 46.0|   NA|TRUE  |\n|Chinstrap |  49.55|   46.350| 58.0| 40.9|TRUE  |\n|Chinstrap |  49.55|   49.550| 58.0| 40.9|TRUE  |\n|Chinstrap |  49.55|   51.075| 58.0| 40.9|TRUE  |\n|Gentoo    |  47.30|   45.300| 59.6|   NA|TRUE  |\n|Gentoo    |  47.30|   47.300| 59.6|   NA|TRUE  |\n|Gentoo    |  47.30|   49.550| 59.6|   NA|TRUE  |\n\n</div>\n:::\n:::\n\n\n\n\n## Collinearity\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(GGally)\n\npenguins |> \n  select(species, \n         island, \n         culmen_length_mm, \n         culmen_depth_mm, \n         flipper_length_mm, \n         body_mass_g, \n         sex) |> \n  ggpairs()\n```\n\n::: {.cell-output-display}\n![](07-data-insights_files/figure-html/unnamed-chunk-23-1.png){fig-align='center' width=100%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npenguins |> \n  ggpairs(columns = c(\n         \"island\", \n         \"culmen_length_mm\", \n         \"culmen_depth_mm\", \n         \"flipper_length_mm\", \n         \"body_mass_g\", \n         \"sex\"), \n         ggplot2::aes(colour = species))\n```\n\n::: {.cell-output-display}\n![](07-data-insights_files/figure-html/unnamed-chunk-24-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\n\n\n## Correlation\n\nA common measure of association between two numerical variables is the correlation coefficient. The correlation metric is a numerical measure of the strength of an association\n\nThere are several measures of correlation including:\n\nPearson's correlation coefficient : good for describing linear associations\n\nSpearman's rank correlation coefficient: a rank ordered correlation - good for when the assumptions for Pearson's correlation is not met.\n\nPearson's correlation coefficient r is designed to measure the strength of a linear (straight line) association. Pearson's takes a value between -1 and 1.\n\nA value of 0 means there is no linear association between the variables\n\nA value of 1 means there is a perfect positive association between the variables\n\nA value of -1 means there is a perfect negative association between the variables\n\nA perfect association is one where we can predict the value of one variable with complete accuracy, just by knowing the value of the other variable.\n\nWe can use the cor function in R to calculate Pearson's correlation coefficient.\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(rstatix)\n\npenguins %>% \n  cor_test(culmen_length_mm, \n           culmen_depth_mm)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|var1             |var2            |   cor| statistic|        p|   conf.low|  conf.high|method  |\n|:----------------|:---------------|-----:|---------:|--------:|----------:|----------:|:-------|\n|culmen_length_mm |culmen_depth_mm | -0.24| -4.459093| 1.12e-05| -0.3328072| -0.1323004|Pearson |\n\n</div>\n:::\n:::\n\n\n\n\nThis tells us two features of the association. It's sign and magnitude. The coefficient is negative, so as bill length increases, bill depth decreases. The value -0.22 indicates that only about 22% of the variation in bill length can be explained by changes in bill depth (and vice-versa), suggesting that the variables are not closely related.\n\nBecause Pearson's coefficient is designed to summarise the strength of a linear relationship, this can be misleading if the relationship is not linear e.g. curved or humped. This is why it's always a good idea to plot the relationship first (see above).\n\nEven when the relationship is linear, it doesn't tell us anything about the steepness of the association (see above). It only tells us how often a change in one variable can predict the change in the other not the value of that change.\n\nThis can be difficult to understand at first, so carefully consider the figure above.\n\nThe first row above shows differing levels of the strength of association. If we drew a perfect straight line between two variables, how closely do the data points fit around this line.\n\nThe second row shows a series of perfect linear relationships. We can accurately predict the value of one variable just by knowing the value of the other variable, but the steepness of the relationship in each example is very different. This is important because it means a perfect association can still have a small effect.\n\nThe third row shows a series of associations where there is clearly a relationship between the two variables, but it is also not linear so would be inappropriate for a Pearson's correlation.\n\nSo what should we do if the relationship between our variables is non-linear or does not follow a normal distribution? Instead of using Pearson's correlation coefficient we can calculate something called a rank correlation.\n\nInstead of working with the raw values of our two variables we can use rank ordering instead. The idea is pretty simple if we start with the lowest vaule in a variable and order it as '1', then assign labels '2', '3' etc. as we ascend in rank order. We can see a way that this could be applied manually with the function dense_rank from dplyr below:\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(rstatix)\n\npenguins %>% \n  cor_test(culmen_length_mm, \n           culmen_depth_mm,\n           method = \"spearman\")\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|var1             |var2            |   cor| statistic|        p|method   |\n|:----------------|:---------------|-----:|---------:|--------:|:--------|\n|culmen_length_mm |culmen_depth_mm | -0.22|   8145268| 3.51e-05|Spearman |\n\n</div>\n:::\n:::\n\n\n\n\nGraphical summaries between numeric variables\n\nCorrelation coefficients are a quick and simple way to attach a metric to the level of association between two variables. They are limited however in that a single number can never capture the every aspect of their relationship. This is why we visualise our data.\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nscatterplot <- ggplot(penguins, aes(x= culmen_length_mm, \n                                    y= culmen_depth_mm)) +\n  geom_point()\n\nscatterplot\n```\n\n::: {.cell-output-display}\n![](07-data-insights_files/figure-html/unnamed-chunk-27-1.png){fig-align='center' width=100%}\n:::\n:::\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\nlibrary(patchwork) # package calls should be placed at the TOP of your script\n\nbill_depth_marginal <- penguins %>% \n  ggplot()+\n  geom_density(aes(x=culmen_depth_mm), fill=\"darkgrey\")+\n  theme_void()+\n  coord_flip() # this graph needs to be rotated\n\nbill_length_marginal <- penguins %>% \n  ggplot()+\n  geom_density(aes(x=culmen_length_mm), fill=\"darkgrey\")+\n  theme_void()\n\nlayout <- \"\nAA#\nBBC\nBBC\"\n# layout is easiest to organise using a text distribution, where ABC equal the three plots in order, and the grid is how much space they take up. We could easily make the main plot bigger and marginals smaller with\n\nscatterplot <- scatterplot +\n  geom_smooth(method = \"lm\",\n              se = FALSE)\n\nbill_length_marginal+scatterplot+bill_depth_marginal+ # order of plots is important\n  plot_layout(design=layout) # uses the layout argument defined above to arrange the size and position of plots\n```\n\n::: {.cell-output-display}\n![](07-data-insights_files/figure-html/unnamed-chunk-28-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\n\n\n\n## Important variables\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\ncolours <- c(\"cyan\",\n             \"darkorange\",\n             \"purple\")\n\nscatterplot_2 <- ggplot(penguins, aes(x= culmen_length_mm, \n                     y= culmen_depth_mm,\n                     colour=species)) +\n    geom_point()+\n  geom_smooth(method=\"lm\",\n              se=FALSE)+\n  scale_colour_manual(values=colours)+\n  theme_classic()+\n  theme(legend.position=\"none\")+\n    labs(x=\"Bill length (mm)\",\n         y=\"Bill depth (mm)\")\n\nbill_depth_marginal_2 <- penguins %>% \n  ggplot()+\n  geom_density(aes(x=culmen_depth_mm,\n                   fill=species),\n               alpha=0.5)+\n  scale_fill_manual(values=colours)+\n  theme_void()+\n  coord_flip() # this graph needs to be rotated\n\nbill_length_marginal_2 <- penguins %>% \n  ggplot()+\n  geom_density(aes(x=culmen_length_mm,\n                   fill=species),\n               alpha=0.5)+\n  scale_fill_manual(values=colours)+\n  theme_void()+\n  theme(legend.position=\"none\")\n\nlayout2 <- \"\nAAA#\nBBBC\nBBBC\nBBBC\"\n\nbill_length_marginal_2+scatterplot_2+bill_depth_marginal_2+ # order of plots is important\n  plot_layout(design=layout2) # uses the layout argument defined above to arrange the size and position of plots\n```\n\n::: {.cell-output-display}\n![](07-data-insights_files/figure-html/unnamed-chunk-29-1.png){fig-align='center' width=100%}\n:::\n:::\n\n\n\n\nWe now clearly see a striking reversal of our previous trend, that in fact within each species of penguin there is an overall positive association between bill length and depth.\n\nThis should prompt us to re-evaluate our correlation metrics:\n\n\n\n\n\n::: {.cell layout-align=\"center\"}\n\n```{.r .cell-code}\npenguins %>% \n  group_by(species) %>% \n  cor_test(culmen_length_mm, \n           culmen_depth_mm)\n```\n\n::: {.cell-output-display}\n<div class=\"kable-table\">\n\n|species   |var1             |var2            |  cor| statistic|     p|  conf.low| conf.high|method  |\n|:---------|:----------------|:---------------|----:|---------:|-----:|---------:|---------:|:-------|\n|Adelie    |culmen_length_mm |culmen_depth_mm | 0.39|  5.193285| 7e-07| 0.2472226| 0.5187796|Pearson |\n|Chinstrap |culmen_length_mm |culmen_depth_mm | 0.65|  7.014647| 0e+00| 0.4917326| 0.7717134|Pearson |\n|Gentoo    |culmen_length_mm |culmen_depth_mm | 0.64|  9.244703| 0e+00| 0.5262952| 0.7365271|Pearson |\n\n</div>\n:::\n:::\n",
    "supporting": [
      "07-data-insights_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}